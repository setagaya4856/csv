<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>éŸ³å£°ã§ãƒ†ãƒ¼ãƒ–ãƒ«ç·¨é›†</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 8px;
    }
  </style>
</head>
<body>

<h2>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«</h2>
<table id="itemTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>å•†å“å</th>
      <th>ã™ã†ã‚Šã‚‡ã†</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>1</td><td>ã‚Šã‚“ã”</td><td>3</td></tr>
    <tr><td>2</td><td>ã¿ã‹ã‚“</td><td>2</td></tr>
    <tr><td></td><td></td><td></td></tr> <!-- ç©ºè¡Œ -->
    <tr><td></td><td></td><td></td></tr> <!-- ç©ºè¡Œ -->
  </tbody>
</table>

<br>
<button onclick="startRecognition()">ğŸ¤ éŸ³å£°å…¥åŠ›é–‹å§‹</button>

<script>
function startRecognition() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'ja-JP';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.start();

  recognition.onresult = function(event) {
    const result = event.results[0][0].transcript;
    console.log("éŸ³å£°å…¥åŠ›: ", result);
    processInput(result);
  };

  recognition.onerror = function(event) {
    alert("éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼: " + event.error);
  };
}

function processInput(input) {
  const parts = input.trim().split(" ");
  if (parts.length !== 3) {
    alert("ã€Œæ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ åˆ‡ã‚Šåˆ†ã‘ãƒ¯ãƒ¼ãƒ‰ æ•°å­—ã€ã®å½¢å¼ã§è©±ã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  const [searchWord, columnWord, numberStr] = parts;
  const number = parseInt(numberStr);
  if (isNaN(number)) {
    alert("æ•°å­—éƒ¨åˆ†ãŒèªè­˜ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚");
    return;
  }

  const table = document.getElementById("itemTable");
  const rows = table.getElementsByTagName("tbody")[0].rows;
  let matched = false;

  for (let row of rows) {
    const idCell = row.cells[0];
    const nameCell = row.cells[1];
    const quantityCell = row.cells[2];

    if (nameCell.textContent.includes(searchWord)) {
      // ä¸€è‡´ã—ãŸè¡Œã‚’ç·¨é›†
      if (columnWord === "ã™ã†ã‚Šã‚‡ã†") {
        quantityCell.textContent = number;
        matched = true;
        break;
      }
    }
  }

  if (!matched) {
    // ç©ºç™½è¡Œã«è¿½åŠ 
    for (let row of rows) {
      const idCell = row.cells[0];
      const nameCell = row.cells[1];
      const quantityCell = row.cells[2];

      if (idCell.textContent.trim() === "") {
        idCell.textContent = generateId(rows); // è‡ªå‹•æ¡ç•ª
        nameCell.textContent = searchWord;
        if (columnWord === "ã™ã†ã‚Šã‚‡ã†") {
          quantityCell.textContent = number;
        }
        break;
      }
    }
  }
}

function generateId(rows) {
  let maxId = 0;
  for (let row of rows) {
    const id = parseInt(row.cells[0].textContent);
    if (!isNaN(id) && id > maxId) {
      maxId = id;
    }
  }
  return maxId + 1;
}
</script>

</body>
</html>
