<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>受付表（夜間緊急当番用）- スマホ直編集 → PDF</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root{
      --ink:#1f2937;
      --grid:#d1d5db;
      --bg:#ffffff;
      --pad:12px;
      --font: system-ui, -apple-system, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      --toolbar-h: 64px;
    }
    html{ -webkit-text-size-adjust: 100%; }
    body { margin:0; font-family: var(--font); background:#f6f7f9; font-size:16px; line-height:1.6; }

    .toolbar { position: fixed; bottom:0; left:0; right:0; display:flex; gap:8px; padding:10px calc(10px + env(safe-area-inset-right)) calc(10px + env(safe-area-inset-bottom)) calc(10px + env(safe-area-inset-left)); background:#fff; border-top:1px solid #ddd; height: var(--toolbar-h); box-sizing: border-box; }
    .btn { flex:1; padding:12px; font-size:16px; font-weight:700; border-radius:10px; border:1px solid #ccc; background:#fff; }
    .btn.primary { background:#0ea5e9; color:#fff; border-color:#0ea5e9; }

    main { display:flex; justify-content:center; padding:12px; padding-bottom: calc(var(--toolbar-h) + 24px + env(safe-area-inset-bottom)); }

    .sheet { background:var(--bg); width: min(100%, 100vw - 16px); max-width: 820px; padding: var(--pad); border:1px solid #e5e7eb; box-shadow:0 2px 8px rgba(0,0,0,.05); margin: 0 auto; }

    .title { text-align:center; font-weight:900; letter-spacing:0.06em; margin: 2px 0 10px; font-size: clamp(22px, 6.2vw, 32px); }
    .subtitle { text-align:center; font-size:14px; opacity:.7; margin-bottom:8px; }

    .grid-table { display:grid; grid-template-columns: minmax(110px, 30%) 1fr; border:1px solid var(--ink); }
    .th, .td { border-right:1px solid var(--ink); border-bottom:1px solid var(--ink); min-height:52px; padding:10px; box-sizing:border-box; }
    .th { background:#f3f4f6; font-weight:700; display:flex; align-items:center; justify-content:center; text-align:center; }
    .td { display:block; white-space: normal; word-break: break-word; overflow-wrap: anywhere; }

    input, textarea, select { width:100%; font-size:16px; padding:10px; border:1px solid var(--grid); border-radius:4px; background:#fff; box-sizing:border-box; line-height:1.6; }
    textarea { resize: vertical; box-sizing:border-box; }
    textarea.short { min-height: 200px; }
    textarea.tall { min-height: 300px; }

    .inline { display:flex; gap:8px; flex-wrap:wrap; }
    .inline input, .inline select { flex:1 1 150px; min-width:0; }

    .checks { display:flex; flex-wrap:wrap; gap:8px 16px; align-items:center; }
    .checks label { display:inline-flex; align-items:center; gap:6px; white-space:normal; writing-mode: horizontal-tb; }
    .checks input[type="checkbox"]{ width:18px; height:18px; }

    .with-suffix { position:relative; flex:1 1 150px; min-width:0; }
    .with-suffix input { padding-right:44px; }
    .suffix { position:absolute; right:10px; top:50%; transform:translateY(-50%); opacity:.7; font-size:14px; pointer-events:none; }

    @media (max-width: 380px){
      .grid-table{ grid-template-columns: 100px 1fr; }
      .th, .td{ min-height: 56px; padding: 10px 8px; }
      .inline{ gap:6px; }
    }

    @media (max-width: 340px){
      .th{ padding: 12px 6px; word-break: keep-all; line-height:1.3; }
    }

    @media print{
      .toolbar { display:none; }
      body{ background:#fff; font-size:14px; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .sheet{ border:none; box-shadow:none; padding: 12mm; width:auto; max-width:none; }
      input::placeholder, textarea::placeholder { color: transparent !important; }
      @page{ size: A4 portrait; margin: 0; }
    }
  </style>
</head>
<body>
  <main>
    <section class="sheet" id="sheet">
      <div class="title">受　付　表</div>
      <div class="subtitle">（夜間緊急当番用）</div>

      <div class="grid-table">
        <div class="th">受付区分</div>
        <div class="td">
          <div class="inline">
            <select><option>JS時間外</option><option>日常受付</option><option>その他</option></select>
            <input type="text" placeholder="名前（直接入力可）" value="イイノ" />
          </div>
        </div>

        <div class="th">受付日時</div>
        <div class="td">
          <div class="inline">
            <input type="date">
            <input type="time">
            <input type="text" placeholder="受付者（直接入力）">
          </div>
        </div>

        <div class="th">団地名</div>
        <div class="td">
          <div class="inline">
            <select><option>滝山団地</option><option>ひばりが丘</option><option>その他</option></select>
            <input type="text" placeholder="直接入力可（任意）">
          </div>
        </div>

        <div class="th">号棟号室</div>
        <div class="td">
          <div class="inline">
            <div class="with-suffix"><input type="text" placeholder="8"><span class="suffix">号棟</span></div>
            <div class="with-suffix"><input type="text" placeholder="208"><span class="suffix">号室</span></div>
          </div>
        </div>

        <div class="th">居住者</div>
        <div class="td">
          <div class="inline"><input type="text" placeholder="名前（様）"></div>
          <div class="inline" style="margin-top:8px">
            <input type="tel" class="tel" placeholder="電話番号1">
            <input type="tel" class="tel" placeholder="電話番号2">
            <input type="tel" class="tel" placeholder="電話番号3">
          </div>
        </div>

        <div class="th">内　容</div>
        <div class="td"><textarea class="short" placeholder="内部改行可（10行程度の高さを確保）"></textarea></div>

        <div class="th">情　報</div>
        <div class="td">
          <div class="checks">
            <label><input type="checkbox">ＪＳ時間外受付番号</label>
            <span>No.<input type="text" style="width:90px"></span>
            <label><input type="checkbox">補修伝票発行済</label>
            <span>No.<input type="text" style="width:90px"></span>
            <label><input type="checkbox">未発行</label>
            <label><input type="checkbox">共益費</label>
            <label><input type="checkbox">個人負担</label>
            <label><input type="checkbox">クレーム</label>
          </div>
        </div>

        <div class="th">経過及び処理</div>
        <div class="td tall">
          <div class="checks" style="margin-bottom:8px">
            <span>※出勤者</span>
            <label><input type="checkbox">本人</label>
            <label><input type="checkbox">業者</label>
            <label><input type="checkbox">その他</label>
            <span><input type="text" placeholder="（直接入力可）" style="width:220px"></span>
          </div>
          <div class="inline" style="margin-top:8px">
            <label style="display:inline-flex; align-items:center; gap:6px">※作業対応
              <select>
                <option>応急処置</option>
                <option>本修理</option>
                <option>調査のみ</option>
                <option>その他</option>
              </select>
            </label>
          </div>
          <div style="margin-top:8px">
            <label style="display:block; font-weight:700; margin-bottom:6px">※対応内容</label>
            <textarea class="short" placeholder="対応内容を記入"></textarea>
          </div>
          <div class="checks" style="margin-top:8px">
            <span>※集金の必要性</span>
            <label><input type="checkbox">有</label>
            <label><input type="checkbox">無</label>
            <span style="margin-left:12px">※JS時間外報告</span>
            <label><input type="checkbox">済</label>
            <label><input type="checkbox">未報告</label>
          </div>
        </div>
      </div>
    </section>
  </main>

  <nav class="toolbar">
    <button class="btn" id="btnPrint">印刷</button>
    <button class="btn primary" id="btnPdf">PDF保存</button>
  </nav>

  <script>
    async function exportPdf(){
      const node = document.getElementById('sheet');
      const canvas = await html2canvas(node, { scale:2, backgroundColor:'#fff' });
      const img = canvas.toDataURL('image/jpeg', 0.98);
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
      const pageW = 210, pageH = 297;
      const imgW = pageW; const imgH = imgW * (canvas.height / canvas.width);
      const y = Math.max(0, (pageH - imgH) / 2);
      pdf.addImage(img, 'JPEG', 0, y, imgW, imgH);
      pdf.save('受付表.pdf');
    }
    document.getElementById('btnPdf').addEventListener('click', exportPdf);
    document.getElementById('btnPrint').addEventListener('click', () => window.print());

    function formatTel(v){
      const d = v.replace(/[^0-9]/g, '');
      if(d.startsWith('0120')){
        if(d.length <= 4) return d;
        if(d.length <= 7) return d.slice(0,4)+'-'+d.slice(4);
        return d.slice(0,4)+'-'+d.slice(4,7)+'-'+d.slice(7,11);
      }
      if(d.length <= 3) return d;
      if(d.length <= 7) return d.slice(0,3)+'-'+d.slice(3);
      return d.slice(0,3)+'-'+d.slice(3,7)+'-'+d.slice(7,11);
    }
    document.querySelectorAll('.tel').forEach(input=>{
      input.addEventListener('input',e=>{ e.target.value=formatTel(e.target.value); });
    });
  </script>
</body>
</html>
