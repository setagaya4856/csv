<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>受付表（夜間緊急当番用）- スマホ直編集 → PDF</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    body { margin:0; font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif; background:#f6f7f9; }
    header { padding: 10px; text-align: center; background:#fff; position:sticky; top:0; z-index:10; }
    header h1 { font-size: 28px; font-weight:900; margin:0; letter-spacing:0.05em; }

    .toolbar { position: fixed; bottom:0; left:0; right:0; display:flex; gap:8px; padding:10px; background:#fff; border-top:1px solid #ddd; }
    .btn { flex:1; padding:12px; font-size:16px; font-weight:700; border-radius:10px; border:1px solid #ccc; }
    .btn.primary { background:#0ea5e9; color:#fff; border-color:#0ea5e9; }

    main { display:flex; justify-content:center; padding:12px; margin-bottom:100px; }
    .sheet { background:#fff; width:100%; max-width:800px; padding:16px; border:1px solid #ddd; box-shadow:0 2px 8px rgba(0,0,0,.05); }
    .row { margin-bottom:12px; }
    label { font-weight:700; display:block; margin-bottom:4px; }
    input, textarea, select { width:100%; font-size:15px; padding:8px; border:1px solid #ccc; border-radius:6px; }
    textarea { min-height: 160px; }
    .checks { display:flex; flex-wrap:wrap; gap:8px; margin-top:6px; }
    .checks label { font-weight:400; display:flex; align-items:center; gap:4px; }
    .inline { display:flex; gap:8px; flex-wrap:wrap; }
    .inline input { flex:1; }
  </style>
</head>
<body>
  <header>
    <h1>受　付　表</h1>
  </header>

  <main>
    <section class="sheet" id="sheet">
      <div class="row">
        <label>[受付区分]</label>
        <select><option>JS時間外</option><option>日常受付</option><option>その他</option></select>
        <input type="text" placeholder="名前（直接入力）" value="イイノ" />
      </div>
      <div class="row">
        <label>[受付日時]</label>
        <input type="date"> <input type="time">
        <input type="text" placeholder="受付者名" />
      </div>
      <div class="row">
        <label>[団地名]</label>
        <select><option>滝山団地</option><option>ひばりが丘</option><option>その他</option></select>
      </div>
      <div class="row">
        <label>[号棟号室]</label>
        <div class="inline">
          <input type="text" placeholder="号棟">
          <input type="text" placeholder="号室">
        </div>
      </div>
      <div class="row">
        <label>[居住者]</label>
        <input type="text" placeholder="名前（様）">
        <div class="inline">
          <input type="tel" class="tel" placeholder="電話番号1">
          <input type="tel" class="tel" placeholder="電話番号2">
          <input type="tel" class="tel" placeholder="電話番号3">
        </div>
      </div>
      <div class="row">
        <label>[内容]</label>
        <textarea placeholder="上階より漏水など"></textarea>
      </div>
      <div class="row">
        <label>[情報]</label>
        <div class="checks">
          <label>□ JS時間外受付番号 No.<input type="text" style="width:80px"></label>
          <label>□ 補修伝票発行済 No.<input type="text" style="width:80px"></label>
          <label><input type="checkbox"> 未発行</label>
          <label><input type="checkbox"> 共益費</label>
          <label><input type="checkbox"> 個人負担</label>
          <label><input type="checkbox"> クレーム</label>
        </div>
      </div>
      <div class="row">
        <label>[経過 及び 処理]</label>
        <textarea placeholder="経過処理を記入" style="min-height:220px"></textarea>
        <div class="checks">
          <label>※出勤者 <input type="checkbox">本人 <input type="checkbox">業者 <input type="checkbox">その他<input type="text" placeholder="記入"></label>
        </div>
        <div class="row">
          <label>※作業対応</label>
          <select><option>応急処置</option><option>本修理</option><option>その他</option></select>
        </div>
        <div class="row">
          <label>※対応内容</label>
          <textarea placeholder="対応内容を記入" style="min-height:160px"></textarea>
        </div>
        <div class="checks">
          <label>※集金の必要性 <input type="checkbox">有 <input type="checkbox">無</label>
          <label>※JS時間外報告 <input type="checkbox">済 <input type="checkbox">未報告</label>
        </div>
      </div>
    </section>
  </main>

  <nav class="toolbar">
    <button class="btn" id="btnPrint">印刷</button>
    <button class="btn primary" id="btnPdf">PDF保存</button>
  </nav>

  <script>
    async function exportPdf(){
      const node = document.getElementById('sheet');
      const canvas = await html2canvas(node, { scale:2, backgroundColor:'#fff' });
      const img = canvas.toDataURL('image/jpeg', 0.98);
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
      const pageW = 210, pageH = 297;
      const imgW = pageW; const imgH = imgW * (canvas.height / canvas.width);
      pdf.addImage(img, 'JPEG', 0, 0, imgW, imgH);
      pdf.save('受付表.pdf');
    }
    document.getElementById('btnPdf').addEventListener('click', exportPdf);
    document.getElementById('btnPrint').addEventListener('click', () => window.print());

    // ===== 電話番号ハイフン自動フォーマット =====
    function formatTel(value){
      const digits = value.replace(/\D/g, '');
      if(digits.length <= 3) return digits;
      if(digits.length <= 7) return digits.replace(/(\d{3})(\d+)/, '$1-$2');
      return digits.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
    }

    document.querySelectorAll('.tel').forEach(input => {
      input.addEventListener('input', e => {
        const cursor = e.target.selectionStart;
        e.target.value = formatTel(e.target.value);
        e.target.setSelectionRange(cursor, cursor);
      });
    });
  </script>
</body>
</html>
