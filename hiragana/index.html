<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CSV 単語ひらがな変換</title>
  <!-- ✅ defer付きで外部ライブラリを読み込む -->
  <script src="https://unpkg.com/kuroshiro" defer></script>
  <script src="https://unpkg.com/kuroshiro-analyzer-kuromoji" defer></script>
</head>
<body>
  <h2>CSVをアップロードして 単語のみ ひらがな変換 → ダウンロード</h2>
  <input type="file" id="csvFileInput" accept=".csv" />
  <button onclick="processCSV()">変換してダウンロード</button>
  <p id="status">ファイルを選択してください</p>

  <!-- ✅ JSコードを defer で動作させる -->
  <script defer>
    window.addEventListener("DOMContentLoaded", () => {
      let kuroshiro;

      async function initKuroshiro() {
        kuroshiro = new Kuroshiro();
        await kuroshiro.init(new KuromojiAnalyzer());
      }

      function safePreprocess(line) {
        return line
          .replace(/[0-9０-９\.．]+/g, "") // 数字・小数点除去
          .replace(/[　\s]+/g, " ")
          .trim();
      }

      window.processCSV = async function () {
        const fileInput = document.getElementById("csvFileInput");
        const status = document.getElementById("status");

        if (!fileInput.files.length) {
          status.textContent = "⚠ ファイルが選択されていません";
          return;
        }

        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = async function (e) {
          try {
            status.innerHTML = "⏳ 変換中...";
            const lines = e.target.result.split(/\r?\n/);
            await initKuroshiro();

            const convertedLines = [];
            let erro
